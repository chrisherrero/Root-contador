<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Contador de Root - Completo</title>
  
<style>
  :root{
    --bg-madera: #2c1d10;
    --panel: rgba(50, 35, 20, 0.92);
    --acento: #dca45c;
    --boton: #d28b45;
    --boton-hover: #e59d52;
    --texto-claro: #f9f5f0;
  }

  #prepList button {
  color: white !important;
}
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    font-family: "Trebuchet MS", Arial, sans-serif;
    background: var(--bg-madera);
    color:var(--texto-claro);
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:1.2rem;
  }
  h1{ margin:0.5rem 0 1rem 0; 
    font-size:clamp(1.4rem, 3.8vw, 2.1rem); 
    
    color: var(--acento); 
    font-weight: 700; 
    letter-spacing: 0.025em; 
    text-shadow: 
      1px 1px 1px rgba(0,0,0,0.7), 
      0 0 6px var(--acento); 
    }

  /* Contenedor principal */
  .contenedor {
    width:100%;
    max-width:1100px;
  }

  /* Pantallas */
  .pantalla { display:none; }
  .activa { display:block; }

  /* Panel configuracion */
  .configuracion {
    background:var(--panel);
    padding:1rem;
    border-radius:12px;
    box-shadow:0 0 12px rgba(0,0,0,0.7);
  }
  .fila { display:flex; gap:1rem; align-items:center; flex-wrap:wrap; justify-content:space-between; }
  label{ font-weight:600; }
  select, input[type="number"], input[type="text"]{
    padding:0.45rem 0.6rem;
    border-radius:8px;
    border:none;
    font-size:1rem;
    background:rgba(255,255,255,0.95);
    color:#000;
  }
  #numJugadores {
    background: rgba(255,255,255,0.95);
    color: #000;
    font-size: 1.1rem;
    padding: 0.5rem 0.7rem;
}
  .switch {
    display:flex;
    align-items:center;
    gap:0.6rem;
  }

  button{
    padding:0.6rem 1rem;
    border-radius:10px;
    border:none;
    background:var(--boton-hover);
    color:white;
    cursor:pointer;
    box-shadow:2px 2px 6px rgba(0,0,0,0.6);
    transition:transform .12s ease, background .12s ease;
  }
  button:hover{ transform:scale(1.03); background:var(--boton-hover) }

  /* Botones específicos siempre naranja */
#iniciarBtn,
#volverBtn,
#resetBtn {
    background: var(--boton-hover) !important; /* siempre naranja */
    color: black !important;
    font-size: 1.2rem;       /* tamaño de texto más grande */
    padding: 0.8rem 1.5rem;  /* más espacio interno */
}

#iniciarBtn:hover,
#volverBtn:hover,
#resetBtn:hover {
    background: var(--boton-hover) !important; /* no cambia al pasar el mouse */
    transform: scale(1.03); /* solo efecto de agrandar */
}

  /* tablero selects - stacked 2 per row cuando espacio */
  .tablero {
    margin-top:1rem;
    display:grid;
    gap:1rem;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    width:100%;
  }

  .jugador {
    border-radius:14px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.55), inset 0 -2px 0 rgba(0,0,0,0.15);
    display:flex;
    flex-direction:column;
    gap:0.6rem;
    align-items:center;
    min-height:150px;
    padding:0.8rem;
    transition:transform .12s ease;
  }
  .jugador:hover{ transform: translateY(-3px); }

  .nombre-j {
    width:100%;
    text-align:center;
    font-weight:700;
    background: rgba(255,255,255,0.85);
    color:#000;
    padding:0.25rem;
    border-radius:6px;
    border:none;
  }

  .selector-row { display:flex; gap:0.6rem; width:100%; align-items:center; justify-content:center; }
  .selector-row select { max-width:220px; width:100%; }
  .alcance-valor { min-width:72px; text-align:center; padding:0.35rem 0.5rem; border-radius:8px; background:rgba(0,0,0,0.28); color:var(--texto-claro); font-weight:700; }

  .puntos {
    font-size:clamp(1.6rem,3.8vw,2.2rem);
    font-weight:900;
    text-shadow:1px 1px 2px rgba(0,0,0,0.8);
    color: #000;
    background: rgba(255,255,255,0.85);
    padding:0.3rem 0.8rem;
    border-radius:8px;
  }

  .mensaje-err { margin-top:0.8rem; color:#ffb3b3; font-weight:700; text-align:center; min-height:1.3rem }
  .alcance-act { margin-top:0.6rem; text-align:center; color:#bfe9ff; font-weight:700 }

  #iniciarBtn { margin:1rem auto 0; display:block; }
  #iniciarBtn:disabled { background:#6b6b6b; cursor:not-allowed; transform:none }

  /* Pantalla juego */
  .juego-area { margin-top:1rem; display:flex; flex-direction:column; gap:1rem; align-items:center; }
  .tablero-juego {
    display:grid;
    gap:1rem;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    width:100%;
  }
  .jugador-juego {
    border-radius:14px;
    padding:0.8rem;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:0.6rem;
    box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    min-height:150px;
  }
  .jugador-juego .nombre-juego {
    width:100%;
    text-align:center;
    font-weight:700;
    padding:0.35rem 0.25rem;
    border-radius:6px;
    border:none;
    font-size: 1.25rem;
  }
/* Botones y layout de score en la pantalla de juego */
.botones {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.6rem;
}


.botones button {
  background: transparent;
  border: none;
  padding: 0.2rem 0.5rem;
  font-size: 2.5rem;        
  font-weight: 900;
  line-height: 1;
  cursor: pointer;
  color: inherit;         /* para que el JS pueda setear color según contraste */
  touch-action: manipulation;
}

/* evitar el efecto de selección molesto en móviles */
.botones button:active { transform: scale(0.95); }

/* Puntos (ahora dentro del row) */
.botones .puntos {
  min-width: 64px;
  text-align: center;
  font-size: clamp(1.9rem, 4.5vw, 2.8rem);
  font-weight: 900;
  background: transparent; /* ahora transparente: el color viene del card */
  color: inherit;
  padding: 0.15rem 0.4rem;
  border-radius: 6px;
}

  .ganador {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) scale(0);
  background: rgba(0, 0, 0, 0.85);
  color: #ffd700; /* dorado */
  padding: 1.5rem 2rem;
  border-radius: 16px;
  font-size: 1.5rem;
  font-weight: 900;
  text-align: center;
  display: none;
  box-shadow: 0 0 20px gold, 0 0 40px rgba(255, 215, 0, 0.4);
  z-index: 999;
  animation: popin 0.5s forwards;
}

.ganador.activo {
  display: block;
}

/* Animación pop-in */
@keyframes popin {
  0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
  60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1); }
}

@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.4); color: var(--acento); } /* Crece y brilla */
  100% { transform: scale(1); }
}

.pop-anim {
  animation: pop 0.3s ease-out;
}

body.no-scroll {
  overflow: hidden;
}

</style>
  
<link rel="icon" type="image/png" href="rootIcon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="rootIcon/favicon.svg" />
<link rel="shortcut icon" href="rootIcon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="rootIcon/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="MyWebSite" />
<link rel="manifest" href="rootIcon/site.webmanifest" />


</head>
<body>

<div class="contenedor">

  <!-- PANTALLA CONFIGURACION -->
  <div id="pantalla-config" class="pantalla activa">
    <h1>Contador de Root — Configuración</h1>
    <div class="configuracion">
      <div class="fila" style="align-items:center;">
        <div style="display:flex;gap:1rem;align-items:center;">
          <label for="numJugadores">Cantidad de jugadores</label>
          <select id="numJugadores">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4" selected>4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>

          <span style="margin-left:0.6rem;">Alcance mínimo:</span>
          <div id="alcanceMin" class="alcance-valor" style="background:rgba(0,0,0,0.28); color:#ffd86b;">21</div>
        </div>

        <div style="display:flex;gap:0.6rem;align-items:center">
          <label for="maxPuntos" style="margin-right:0.3rem;">Puntaje máximo</label>
          <input id="maxPuntos" type="number" value="30" min="1" max="100" style="width:86px">
        </div>
      </div>

      <div class="panel-config" style="margin-top:0.8rem; display:flex; justify-content:space-between; align-items:center;">
        <div style="flex:1">
        </div>

        <div style="display:flex;align-items:center;gap:1rem">
          <div class="switch">
            <label for="switchAlcance">Validar alcance</label>
            <input type="checkbox" id="switchAlcance" checked>
          </div>
          <button id="resetBtn">Reiniciar</button>
        </div>
      </div>

      <div id="tablero" class="tablero"></div>

      <div id="alcanceActual" class="alcance-act">Alcance actual: 0</div>
      <div id="mensajeError" class="mensaje-err"></div>

      <button id="iniciarBtn" disabled>Comenzar partida</button>
    </div>
  </div>

  <!-- PANTALLA JUEGO -->
  <div id="pantalla-juego" class="pantalla">
    <h1>Contador de Root — Partida</h1>
    <div class="configuracion juego-area">
      <div style="width:100%; display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong>Puntaje máximo:</strong> <span id="maxPuntosJuego">30</span>
        </div>
        <div>
          <button id="volverBtn">Volver</button>
        </div>
      </div>

      <div id="tableroJuego" class="tablero-juego"></div>

      <div id="mensajeGanador" class="ganador"></div>
    </div>
  </div>

</div>

<script>
/* Datos facciones (colores y alcances base) */
const facciones = [
  { nombre: "Marquesado", color: "#f7852a", alcanceBase: 10 },
  { nombre: "Nido de Águilas", color: "#325a9b", alcanceBase: 7 },
  { nombre: "Alianza del Bosque", color: "#6cc46d", alcanceBase: 3 },
  { nombre: "Vagabundo (B)", color: "#f7f7f7", alcanceBase: 5 }, // blanco
  { nombre: "Vagabundo (N)", color: "#111111", alcanceBase: 2 }, // negro (base 2, regla dinámica)
  { nombre: "Compañía del Río", color: "#5fc9e3", alcanceBase: 5 },
  { nombre: "Culto Reptiliano", color: "#f0e300", alcanceBase: 2 },
  { nombre: "Ducado Subterráneo", color: "#e6cfa7", alcanceBase: 8 },
  { nombre: "Conspiración Córvida", color: "#5c3a91", alcanceBase: 3 },
  { nombre: "Señor de los Cientos", color: "#e04b3e", alcanceBase: 9 },
  { nombre: "Guardianes de Hierro", color: "#555555", alcanceBase: 8 }
];

const alcanceMinimoPorJugadores = { 2:17, 3:18, 4:21, 5:25, 6:28 };

/* DOM */
const pantallaConfig = document.getElementById('pantalla-config');
const pantallaJuego = document.getElementById('pantalla-juego');
const numJugadoresSelect = document.getElementById('numJugadores');
const tablero = document.getElementById('tablero');
const alcanceMinDiv = document.getElementById('alcanceMin');
const alcanceActualDiv = document.getElementById('alcanceActual');
const mensajeErrorDiv = document.getElementById('mensajeError');
const iniciarBtn = document.getElementById('iniciarBtn');
const resetBtn = document.getElementById('resetBtn');
const switchAlcance = document.getElementById('switchAlcance');
const maxPuntosInput = document.getElementById('maxPuntos');

const tableroJuego = document.getElementById('tableroJuego');
const volverBtn = document.getElementById('volverBtn');
const maxPuntosJuegoSpan = document.getElementById('maxPuntosJuego');
const mensajeGanadorDiv = document.getElementById('mensajeGanador');

numJugadoresSelect.addEventListener('change', generarTablero);
resetBtn.addEventListener('click', generarTablero);
iniciarBtn.addEventListener('click', comenzarPartida);
// reemplazo: doble confirm estilo "¿Estás seguro?"
let volverConfirmando = false;
let volverTimeoutId = null;

volverBtn.addEventListener('click', () => {
  if (!volverConfirmando) {
    volverConfirmando = true;
    const originalText = volverBtn.textContent;
    volverBtn.textContent = '¿Estás seguro?';
    // volver al texto original pasados 3s si no se confirma
    volverTimeoutId = setTimeout(() => {
      volverConfirmando = false;
      volverBtn.textContent = originalText;
    }, 3000);
  } else {
    // si ya estaba en modo confirmación, hacemos la acción real
    if (volverTimeoutId) { clearTimeout(volverTimeoutId); volverTimeoutId = null; }
    volverConfirmando = false;
    volverBtn.textContent = 'Volver';
    // llamar a la función que ya tenías
    volverAConfig();
  }
});

/* util contraste */
function esColorOscuro(hex){
  hex = hex.replace('#','');
  const r = parseInt(hex.substring(0,2),16);
  const g = parseInt(hex.substring(2,4),16);
  const b = parseInt(hex.substring(4,6),16);
  const brillo = (r*299 + g*587 + b*114) / 1000;
  return brillo < 150;
}

/* genera selects por jugadores y preselecciona facciones únicas por orden */
function generarTablero(){
  const n = parseInt(numJugadoresSelect.value);
  alcanceMinDiv.textContent = alcanceMinimoPorJugadores[n];
  mensajeErrorDiv.textContent = '';
  iniciarBtn.disabled = true;
  tablero.innerHTML = '';

  // preselección única: las primeras n facciones del array
  const preseleccion = facciones.slice(0,n).map(f=>f.nombre);

  for(let i=0;i<n;i++){
    const card = document.createElement('div');
    card.className = 'jugador';

    // pintamos todo el card con color por defecto de la facción preseleccionada
    const facPre = facciones[i % facciones.length];
    card.style.background = facPre.color;
    // texto del nombre por defecto = nombre de la faccion
    const nombreInput = document.createElement('input');
    nombreInput.className = 'nombre-j';
    nombreInput.type = 'text';
    nombreInput.value = facPre.nombre;
    nombreInput.dataset.default = facPre.nombre;

    // selector y etiqueta alcance
    const selRow = document.createElement('div');
    selRow.className = 'selector-row';
    const select = document.createElement('select');
    select.id = `faccionSelect_${i}`;

    // construir opciones; para vagabundos mostramos (5/2) en la etiqueta

// opciones de facciones
facciones.forEach(f => {
  let label = `${f.nombre} (${f.alcanceBase})`;
  if(f.nombre === 'Vagabundo (B)' || f.nombre === 'Vagabundo (N)') {
    label = `${f.nombre} (5/2)`; 
  }
  const opt = document.createElement('option');
  opt.value = f.nombre;
  opt.textContent = label;
  opt.style.color = '#000';       // <-- color oscuro fijo
  select.appendChild(opt);
});


    // preselección de la facción única por defecto
    if(preseleccion[i]) select.value = preseleccion[i];

    const alcanceLabel = document.createElement('div');
    alcanceLabel.className = 'alcance-valor';
    alcanceLabel.id = `alcVal_${i}`;
    alcanceLabel.textContent = '-';

    selRow.appendChild(select);
    selRow.appendChild(alcanceLabel);

    // puntos display (sólo visual en config)
    const puntosDiv = document.createElement('div');
    puntosDiv.className = 'puntos';
    puntosDiv.textContent = ''; // quitamos el 0 inútil

    // montar card
    card.appendChild(nombreInput);
    card.appendChild(selRow);
    card.appendChild(puntosDiv);
    tablero.appendChild(card);

    // evento select
    select.addEventListener('change', manejarCambio);
    // si se cambia el nombre a vacío, devolver al nombre por defecto (faccion) cuando cambie facción
    nombreInput.addEventListener('input', ()=>{ /* nada por ahora */ });
  }

  // actualizar todo
  manejarCambio();
}


/* maneja cambios: evita duplicados, actualiza colores de card y alcances por select */
function manejarCambio(){
  const selects = Array.from(document.querySelectorAll("select[id^='faccionSelect_']"));
  const seleccionadas = selects.map(s => s.value).filter(v=>v && v.length>0);

  // deshabilitar duplicados (salvo en su propio select)
  selects.forEach(sel => {
    const valorActual = sel.value;
    Array.from(sel.options).forEach(opt => {
        if(opt.value === '') { 
            opt.disabled = false; 
            opt.style.color = '#000';  // siempre negro
            return; 
        }

        if(opt.value !== valorActual && seleccionadas.includes(opt.value)) {
            opt.disabled = true;
            opt.style.color = '#888'; // gris clarito para los no disponibles
        } else {
            opt.disabled = false;
            opt.style.color = '#000'; // negro para los disponibles
        }
    }); // cierra Array.from(sel.options).forEach
}); // cierra selects.forEach



  // actualizar color de cada card y el texto del nombre (si es el nombre default lo actualiza al nombre de la faccion)
  selects.forEach((sel, idx) => {
    const val = sel.value;
    const card = sel.closest('.jugador');
    const nombreInput = card.querySelector('.nombre-j');
    if(val){
      const f = facciones.find(x=>x.nombre===val);
      card.style.background = f.color;
      // si el nombre coincide con el nombre por defecto anterior o está vacío, setear nombre por defecto
      if(!nombreInput.value || nombreInput.value === nombreInput.dataset.default) {
        nombreInput.value = f.nombre;
      }
      nombreInput.dataset.default = f.nombre;
      // colores de texto y puntos se adaptan para legibilidad
      nombreInput.style.color = esColorOscuro(f.color) ? '#fff' : '#000';
      nombreInput.style.background = esColorOscuro(f.color) ? 'rgba(255,255,255,0.12)' : 'rgba(255,255,255,0.85)';
      const puntosDiv = card.querySelector('.puntos');
      sel.style.color = esColorOscuro(f.color) ? '#fff' : '#000';
      sel.style.background = esColorOscuro(f.color) ? 'rgba(255,255,255,0.3)' : 'rgba(255,255,255,0.95)';
      puntosDiv.style.color = esColorOscuro(f.color) ? '#fff' : '#000';
      puntosDiv.style.background = esColorOscuro(f.color) ? 'rgba(0,0,0,0.26)' : 'rgba(255,255,255,0.85)';
    } else {
      // sin selección: card neutro
      card.style.background = 'linear-gradient(135deg,#444,#222)';
      nombreInput.dataset.default = '';
      sel.style.color = '#000';
      sel.style.background = 'rgba(255,255,255,0.95)';
    }
  });

  // recalcular alcance total y actualizar alcances por select (regla vagabundos)
  calcularAlcanceYActualizarUI();
}

/* calcula alcance total y fija el valor al lado de cada select */
function calcularAlcanceYActualizarUI(){
  const selects = Array.from(document.querySelectorAll("select[id^='faccionSelect_']"));
  const nombres = selects.map(s=>s.value);

  const idxVB = nombres.indexOf('Vagabundo (B)');
  const idxVN = nombres.indexOf('Vagabundo (N)');
  const hayVB = idxVB !== -1;
  const hayVN = idxVN !== -1;

  let total = 0;

  selects.forEach((sel, idx) => {
    const val = sel.value;
    const alcElem = document.getElementById(`alcVal_${idx}`);
    if(!val){ alcElem.textContent = '-'; return; }

    let f = facciones.find(x=>x.nombre === val);
    let alcanceAqui = f.alcanceBase;

    if(val === 'Vagabundo (B)' || val === 'Vagabundo (N)'){
      if(hayVB && hayVN){
        // ambos presentes -> primero en orden = 5, segundo = 2
        if(idxVB < idxVN){
          alcanceAqui = (val === 'Vagabundo (B)') ? 5 : 2;
        } else {
          alcanceAqui = (val === 'Vagabundo (N)') ? 5 : 2;
        }
      } else {
        // solo uno -> 5
        alcanceAqui = 5;
      }
    }

    alcElem.textContent = alcanceAqui;
    total += alcanceAqui;
  });

  const n = parseInt(numJugadoresSelect.value);
  const minReq = alcanceMinimoPorJugadores[n];
  alcanceActualDiv.textContent = `Alcance actual: ${total} / ${minReq}`;

  const faltan = nombres.some(v=>!v || v.length===0);
  const validarAlcance = switchAlcance.checked;

  if(faltan){
    mensajeErrorDiv.textContent = '⚠️ Faltan jugadores por asignar.';
    iniciarBtn.disabled = true;
  } else if(validarAlcance && total < minReq){
    mensajeErrorDiv.textContent = `⚠️ Alcance mínimo requerido: ${minReq}. (actual ${total})`;
    iniciarBtn.disabled = true;
  } else {
    mensajeErrorDiv.textContent = '';
    iniciarBtn.disabled = false;
  }
}

/* Al comenzar partida: pasar a la pantalla de juego con los jugadores configurados */
function comenzarPartida(){
  // armar estructura de jugadores
  const selects = Array.from(document.querySelectorAll("select[id^='faccionSelect_']"));
  const jugadores = selects.map((s, idx) => {
    const card = s.closest('.jugador');
    const nombre = card.querySelector('.nombre-j').value || s.value || `Jugador ${idx+1}`;
    const fac = facciones.find(f => f.nombre === s.value);
    return {
      nombre,
      faccion: s.value,
      color: fac ? fac.color : '#777',
      alcanceBase: fac ? fac.alcanceBase : 0
    };
  });

  // guardamos max puntos
  const maxP = parseInt(maxPuntosInput.value) || 30;
  maxPuntosJuegoSpan.textContent = maxP;

  // construir pantalla de juego
  tableroJuego.innerHTML = '';
  mensajeGanadorDiv.classList.remove('activo');
  mensajeGanadorDiv.textContent = '';

  jugadores.forEach((j, idx) => {
    const div = document.createElement('div');
    div.className = 'jugador-juego';
    div.style.background = j.color;
    // texto claro u oscuro según contraste
    const textoClaro = esColorOscuro(j.color) ? '#fff' : '#000';
    div.dataset.faccion = j.faccion;

    const nombreInput = document.createElement('input');
    nombreInput.className = 'nombre-juego';
    nombreInput.type = 'text';
    nombreInput.value = j.nombre;
    nombreInput.style.color = textoClaro;
    nombreInput.style.background = 'transparent';


const puntosDiv = document.createElement('div');
puntosDiv.className = 'puntos';
puntosDiv.textContent = '0';

// nuevos botones a los lados del número
const botones = document.createElement('div');
botones.className = 'botones';
const btnMenos = document.createElement('button');
btnMenos.type = 'button';
btnMenos.className = 'btn-menos';
btnMenos.textContent = '−'; // signo largo
const btnMas = document.createElement('button');
btnMas.type = 'button';
btnMas.className = 'btn-mas';
btnMas.textContent = '+';
btnMenos.style.color = textoClaro;
btnMas.style.color = textoClaro;
puntosDiv.style.color = textoClaro;


// orden: menos - puntos - mas
botones.appendChild(btnMenos);
botones.appendChild(puntosDiv);
botones.appendChild(btnMas);

// añadimos solo nombreInput + botones (sin facLabel)
div.appendChild(nombreInput);
div.appendChild(botones);


    tableroJuego.appendChild(div);

    // listeners para +/- (controlan puntos y ganadores)
    btnMas.addEventListener('click', ()=>{
      let pts = parseInt(puntosDiv.textContent) || 0;
      pts++;
      puntosDiv.textContent = pts;

      puntosDiv.classList.remove('pop-anim'); // Resetea por si se clickea rápido
  void puntosDiv.offsetWidth; // Truco para forzar el reinicio de la anim
  puntosDiv.classList.add('pop-anim'); // ¡Aplica la animación!

      chequearGanador();
      guardarEstadoJuego();
    });
    btnMenos.addEventListener('click', ()=>{
      let pts = parseInt(puntosDiv.textContent) || 0;
      pts = Math.max(0, pts-1);
      puntosDiv.textContent = pts;
      guardarEstadoJuego();
    });
  });

  // cambiar pantalla
  pantallaConfig.classList.remove('activa');
  pantallaConfig.classList.add('pantalla');
  pantallaJuego.classList.remove('pantalla');
  pantallaJuego.classList.add('activa');
}

/* Chequeo ganador: si alguien llega al maxPuntos, mostrar mensaje */
function chequearGanador(){
  const maxP = parseInt(maxPuntosInput.value) || 30;
  const puntos = Array.from(document.querySelectorAll('#tableroJuego .puntos')).map(d=>parseInt(d.textContent)||0);
  const ganadorIdx = puntos.findIndex(p=>p >= maxP);
  if(ganadorIdx !== -1){
    const nombres = Array.from(document.querySelectorAll('#tableroJuego .nombre-juego')).map(n=>n.value);
    const ganador = nombres[ganadorIdx] || `Jugador ${ganadorIdx+1}`;
    mensajeGanadorDiv.textContent = ` ¡${ganador} ganó la partida con ${puntos[ganadorIdx]} puntos! `;
    mensajeGanadorDiv.classList.add('activo');
    // opcional: desactivar botones (si vos querés que siga el juego sacalo)
    Array.from(document.querySelectorAll('#tableroJuego .botones button')).forEach(b => b.disabled = true);
  }
}
/* guardar estado del juego en localStorage */
function guardarEstadoJuego() {
    const jugadores = Array.from(document.querySelectorAll('#tableroJuego .jugador-juego')).map(j => {
        return {
            nombre: j.querySelector('.nombre-juego').value,
            faccion: j.dataset.faccion,
            color: j.style.background,
            puntos: parseInt(j.querySelector('.puntos').textContent) || 0
        };
    });
    const maxP = parseInt(maxPuntosInput.value) || 30;
    const numJugadores = parseInt(numJugadoresSelect.value);
    const validarAlcance = switchAlcance.checked;
    
    const estado = { jugadores, maxP, numJugadores, validarAlcance };
    localStorage.setItem('rootJuego', JSON.stringify(estado));
}

/* volver a configuracion */
function volverAConfig(){
  localStorage.removeItem('rootJuego'); // limpiar el estado guardado
  
  pantallaJuego.classList.remove('activa');
  pantallaJuego.classList.add('pantalla');
  pantallaConfig.classList.remove('pantalla');
  pantallaConfig.classList.add('activa');
  mensajeGanadorDiv.classList.remove('activo');
  mensajeGanadorDiv.textContent = '';
  generarTablero();
}

/* iniciar */
generarTablero();

/* Exponer una función por si querés recargar desde consola */
window.regenerar = generarTablero;
// Restaurar juego al recargar la página

window.addEventListener('load', ()=>{
  const estado = localStorage.getItem('rootJuego');
  if(estado){
    const data = JSON.parse(estado);

    maxPuntosInput.value = data.maxP || 30;
    numJugadoresSelect.value = data.numJugadores || 4;
    switchAlcance.checked = data.validarAlcance ?? true;

    generarTablero();

    const selectsConfig = Array.from(document.querySelectorAll("select[id^='faccionSelect_']"));
    selectsConfig.forEach((select, idx) => {
      if (!data.jugadores[idx]) return; // Seguridad
      const j = data.jugadores[idx];
      const card = select.closest('.jugador');
      card.querySelector('.nombre-j').value = j.nombre;
      select.value = j.faccion || '';
      card.querySelector('.puntos').textContent = j.puntos > 0 ? j.puntos : '';
    });

    manejarCambio();

    const hayPartidaGuardada = data.jugadores.some(j => j.puntos > 0);

    if (hayPartidaGuardada) {

      comenzarPartida();

      const puntosDivsJuego = Array.from(document.querySelectorAll('#tableroJuego .puntos'));
      puntosDivsJuego.forEach((puntosDiv, idx) => {
        if (data.jugadores[idx]) {
                  puntosDiv.textContent = data.jugadores[idx].puntos || 0;
        }
      });

      chequearGanador();
    }
  }
});


</script>



<!-- Botón flotante -->
<button id="openPreparations" class="fixed top-4 right-4 bg-gray-700 text-white px-4 py-2 rounded-xl shadow-md hover:bg-gray-600 transition">
  Preparaciones
</button>

<!-- Fondo gris traslúcido -->
<div id="prepOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-40"></div>

<!-- Ventana principal con lista -->
<div id="prepWindow" class="hidden fixed inset-0 flex items-center justify-center z-50">
  <div class="bg-gray-900/90 backdrop-blur-lg rounded-2xl w-[90%] max-w-md shadow-xl relative flex flex-col max-h-[80vh]">
    
    <!-- Botón siempre fijo -->
    <button id="closePrep" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-700/80 hover:bg-gray-600 text-white flex items-center justify-center shadow-lg">
      ✕
    </button>

    <!-- Contenido scrollable -->
    <div class="p-6 overflow-y-auto custom-scroll flex-1">
      <h2 class="text-2xl font-bold text-white mb-4">Preparaciones</h2>
      <div id="prepList" class="flex flex-col gap-5"></div>

      <div class="mt-6 flex justify-between">
        <a href="https://root.seiyria.com/" target="_blank" class="text-blue-400 underline font-semibold hover:text-blue-300">
        Reglas del juego
        </a>
        <a href="#" class="text-blue-400 underline font-semibold hover:text-blue-300 cursor-pointer showQR-trigger">
          QR
        </a>
      </div>
      
</div>
    </div>

  </div>


<!-- Ventana de detalle -->
<div id="prepDetails" class="hidden fixed inset-0 flex items-center justify-center z-50">
  <div class="bg-gray-900/95 backdrop-blur-lg rounded-2xl w-[90%] max-w-md shadow-xl relative flex flex-col max-h-[80vh]">
    
    <!-- Botón siempre fijo -->
    <button id="closeDetails" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-gray-700/80 hover:bg-gray-600 text-white flex items-center justify-center shadow-lg">
      ✕
    </button>

    <!-- Contenido scrollable -->
    <div class="p-6 overflow-y-auto custom-scroll flex-1">
      <h3 id="detailsTitle" class="text-xl font-bold text-white mb-2"></h3>
      <p id="detailsMode" class="text-sm text-gray-400 mb-4"></p>
      <div id="detailsText" class="text-gray-100 whitespace-pre-line mb-4"></div>

        <div class="mt-6 flex justify-between mb-4">
          <a href="https://root.seiyria.com/" target="_blank" class="text-blue-400 underline font-semibold hover:text-blue-300">
          Reglas del juego
        </a>
        <a href="#" class="text-blue-400 underline font-semibold hover:text-blue-300 cursor-pointer showQR-trigger">
          QR
        </a>
        </div>
          </div>

  </div>
</div>


<!-- Scroll estilizado -->
<style>
  .custom-scroll::-webkit-scrollbar {
    width: 6px;
  }
  .custom-scroll::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
  }
  .custom-scroll::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.5);
  }
</style>

<!-- ================= Script ================= -->
<script>

  
const prepData = {

"Inicio de partida" : {
  normal: `
Preparación básica

Paso 1: Asignar Facciones y Jugador Inicial. Asigna una facción a cada jugador usando cualquier método. Determina al azar el orden de asiento y el jugador inicial, el orden de turno va hacia su izquierda. Cada jugador toma su tablero de facción y todas sus piezas, tal y como se describe en la parte trasera del mismo. 
Paso 2: Preparar Marcadores de Puntuación. 
Paso 3: Robar Mano Iniciales. Si estáis jugando dos jugadores, quita las cuatro cartas de dominancia del mazo. Baraja el mazo. Cada jugador roba tres cartas. 
Paso 4: Colocar Ruinas. Coloca una ficha de ruina en cada espacio del mapa marcado con una "R" (cuatro en total). 
Paso 5: Formar la Reserva común de Objetos.Coloca estos objetos en los espacios correspondientes de la reserva de objetos en la parte superior del mapa: 2 botas , 2 bolsas , 1 ballesta , 1 martillo , 2 espadas , 2 teteras, 2 monedas . 
Paso 6: Otras Piezas. coloca los dos dados junto al mapa. 
Paso 7: Preparar Facciones. En orden de preparación (A, B, C, etc.) cada jugador sigue las instrucciones de preparación.`,

  avanzada: `
Preparación avanzada

Paso 1: Escoger y Preparar un Mapa Como grupo, escojan un mapa. Si escogen un mapa alternativo ver las reglas del juego, después reunir los 12 marcadores de palo, mezclarlos, y colocar uno en cada claro aleatoriamente de modo que cubran el símbolo de palo impreso, si lo hay. Preparar las ruinas, la reserva de objetos, y los dados. 
Paso 2: Escoger un Mazo Como grupo, pueden escoger reemplazar todo el mazo estándar por el mazo de Exiliados y Partisanos (si lo tienen). 
Paso 3: Preparar Bots Como grupo, pueden escoger jugar con bots, tal como se describe en la Ley de la Rootbótica. (ver reglas de juego) 
Paso 4: Sentar a los Jugadores, Determinar aleatoriamente el orden de asiento y el primer jugador, el orden de turno va hacia su izquierda. 
Paso 5: Preparar los Lugares Míticos (si los tienen), Como grupo, pueden escoger usar lugares míticos (ver reglas del juego). Si lo hacen, pueden ignorar la colocación de las piezas de la Torre o el Transbordador indicadas en los Mapas Alternativos (ver reglas). 
Paso 5.1: Elegir, Como grupo, elegir si usan uno o dos lugares míticos, y devolver a la caja cualesquiera cartas de lugares míticos que no quieran usar en la partida. 
Paso 5.2: Repartir y Reunir, Barajar las cartas de lugares míticos seleccionadas, robas el número elegido (uno o dos) y reunir las piezas de los lugares míticos mostradas en cada carta robada. 
Paso 5.3: Preparar, El último jugador según el orden de turno prepara un lugar mítico tal y como se indica en su carta. Si eligieron jugar con dos lugares míticos, el penúltimo jugador en orden de turno prepara el otro lugar mítico como indica su carta. 
Paso 6: Preparar Secuaces (si los tienen), Como grupo, pueden escoger jugar con exactamente tres secuaces (ver reglas del juego), como se indica a continuación. 
Paso 6.1: Reunir las piezas, Barajar las cartas de secuaces. Robar tres cartas de secuaces y devolver el resto a la caja. Reunir las piezas de los secuaces robados formando una reserva. 
Paso 6.2: Degradar, Si es una partida de tres jugadores, voltear a uno de los secuaces al azar a su cara de Degradado (marcada con una "D"). Si es una partida a cuatro jugadores, voltear a dos secuaces al azar a sus caras de Degradado. Si la partida es a cinco o más jugadores, voltear a los tres secuaces a su cara de Degradado. 
Paso 6.3: Preparar los Secuaces, Empezando por el último jugador en orden de turno y yendo en sentido inverso al orden de turno, cada jugador prepara a uno de los secuaces seleccionados siguiendo las instrucciones en su carta de secuaz (algunos no tienen instrucciones). 
Paso 6.4: Colocar Marcadores de Secuaces, Colocar los tres marcadores de secuaces con el lado mostrando un "4", "8", y "12" bocarriba tapando las casillas "4", "8", y "12" del contador de puntuación en el mapa. 
Paso 6.5: Devolver a la caja las Facciones coincidentes. Una facción no puede seleccionarse para la partida si su respectivo secuaz está en juego (indicado por el icono y el color en su lateral). Devuelve los tableros, piezas y cartas de preparación de dichas facciones a la caja. 
Paso 7: Robar Cinco Cartas, Si es una partida a dos jugadores, retirar del mazo las cuatro cartas de dominancia y devolverlas a la caja. Barajar el mazo. Cada jugador roba cinco cartas. (¡No tres como en la preparación estándar! Seleccionarás y te quedarás con tres cartas en el paso 10). 
Paso 8: Preparar las Facciones, Como grupo, pueden escoger y preparar las facciones como se describe en la Preparación Estándar o pueden usar las cartas de preparación de facción incluidas en la expansión de Los Merodeadores, como se describe abajo. 
Paso 8.1: Repartir Cartas de Preparación, (o usar la calculadora en las reglas del juego) Barajar las cartas de preparación de las facciones belicosas (nombre en rojo con una espada) y robar una al centro de la mesa. Barajar el resto de cartas de preparación de las facciones belicosas con todas las cartas de preparación de las facciones insurgentes (nombre en gris sin espada) y robar una carta por jugador al centro de la mesa. (Habrá una carta de preparación de facción más que el número de jugadores). Si es una partida a dos jugadores, retirar todas las cartas de preparación de facciones insurgentes antes de robar ninguna carta (Pueden dejarlas si juegan con Secuaces y se atreven). 
Paso 8.1.1: Bloquear al último insurgente. Si la última carta de preparación de facción robada es insurgente, giradla horizontalmente para mostrar que está bloqueada. No puede escogerse a menos que, como mínimo, una facción belicosa haya sido escogida. 
Paso 8.1.2: Vagabundo, Cuando se robe una carta de preparación de facción de Vagabundo, robar también una carta de personaje de Vagabundo al azar y situarla a su lado bocarriba. Si un jugador escoge a ese Vagabundo como su facción, debe usar esa carta de personaje. 
Paso 8.2: Escoger Facciones, Empezando por el último jugador en orden de turno y yendo en sentido inverso al orden de turno, cada jugador escoge una de las cartas de preparación de facción del centro de la mesa y prepara su facción en ese instante (antes de que el siguiente jugador escoja). 
Paso 8.2.1: Hogar, Al preparar su facción, los jugadores podrían tener que elegir uno o más claro como claros hogar. Los jugadores no pueden escoger como claros hogar claros que sus enemigos ya hayan escogido como sus claros hogar o claros donde no puedan colocar las piezas indicadas en su preparación. 
Paso 8.2.2: Patrias Adyacentes, Algunas facciones te indican que escojas claros patria que no sean adyacentes a claros patria enemigos, o que haya dos o más claros entre ellos y claros patria enemigos. Si no puedes cumplir un requisito de "dos o más claros entre ellos", puedes escoger un claro patria que no sea adyacente a un claro hogar enemigo. Si no puedes cumplir un requisito de "no adyacente", puedes escoger un claro patria que sea adyacente a un claro hogar enemigo. (Sencillamente, piensa en esto como en "Intenta empezar lo más alejado posible"). 
Paso 9: Preparar Marcadores de Puntuación, 
Paso 10: Seleccionar las Manos Iniciales, Cada jugador escoge tres cartas para mantener en su mano y coloca las otras dos bocabajo en el mazo común. Cuando todos lo hayan hecho, barajar el mazo.
`
},


  "Marquesado": {
    normal: `• Paso 1: Juntar Guerreros y Madera. Forma las reservas de guerreros (25) y de fichas de madera (8).
• Paso 2: Colocar La Fortaleza. Coloca la ficha de fortaleza en el claro de una esquina a tu elección.
• Paso 3: Guarnición. Coloca un guerrero en cada claro excepto en el claro que está en la esquina diagonalmente opuesta al claro de la ficha de fortaleza.
• Paso 4: Colocar los Edificios Iniciales. Coloca 1 aserradero, 1 taller y 1 reclutador. Puedes colocarlos en el claro de la ficha de fortaleza o en claros adyacentes, en cualquier combinación.
• Paso 5: Rellenar Contadores. Coloca tus 5 aserraderos, 5 talleres, y 5 reclutadores restantes en sus correspondientes contadores de edificios de derecha a izquierda (esto rellena todos los espacios excepto el de más a la izquierda de cada contador).`,

    avanzada: `1º: Elige 3 claros de hogar, cada uno adyacente a otro de tus claros de hogar.
2º: Pon 3 guerreros en cada uno de tus hogares. Pon 1 guerrero en cada otro claro.
3º: Pon el castillo en uno de tus hogares, no adyacente a un hogar enemigo si es posible.
4º: Pon 1 aserradero, 1 taller y 1 reclutador en cada claro de un hogar diferente (si es posible).
5º: Llena tu registro de Edificios con tus edificios, excepto los espacios de más a la izquierda.`
  },

  "Nido de Águilas": {
    normal: `• Paso 1: Juntar Guerreros. Forma la reserva de guerreros (20).
• Paso 2: Colocar Nido y Guerreros Iniciales. Coloca 1 nido y 6 guerreros en el claro de la esquina diagonalmente opuesta al claro donde está la ficha de fortaleza.
• Paso 3: Escoger Líder. Elige 1 de las 4 cartas de líder y colócala en tu espacio de carta de líder.
• Paso 4: Colocar Visires. Coloca tus 2 cartas de Visir Leal, mostrando su palo, en las columnas de Decreto según marque tu líder.
• Paso 5: Rellenar Contador. Coloca tus 6 nidos restantes en tu contador de nidos, de derecha a izquierda.`,

    avanzada: `1º: Elige un claro de hogar en el borde del mapa que tenga 3+ claros entre él y los hogares enemigos.
2º: Pon 6 guerreros y 1 nido en tu hogar.
3º: Pon cualquier carta de Líder en tu espacio de Carta de Líder. Mantén los otros 3 líderes boca arriba cerca.
4º: Mete tus 2 Visires Leales bajo el espacio de columnas del Decreto como se indica en tu líder actual.
5º: Llena tus espacios de Nidos con nidos, excepto el de más a la izquierda.`
  },

  "Alianza del Bosque": {
    normal: `• Paso 1: Juntar Guerreros. Forma la reserva de guerreros (10).
• Paso 2: Colocar Bases. Coloca 3 bases en los espacios correspondientes de tu zona de bases.
• Paso 3: Rellenar el Contador de Simpatía. Coloca allí 10 fichas de simpatía.
• Paso 4: Obtener Simpatizantes. Roba 3 cartas y colócalas bocabajo en tu montón de simpatizantes.`,

    avanzada: `1º: Roba 3 cartas y añádelas boca abajo a tu pila de Simpatizantes.
2º: Llena tu registro de Simpatía con fichas de simpatía.
3º: Pon tus 3 Bases en tus espacios de Bases correspondientes.`
  },

  "Vagabundo": {
    normal: `• Paso 1: Elegir un Personaje. Elige una carta de personaje y colócala en tu espacio de carta de personaje.
• Paso 2: Colocar el Peón. Coloca tu peón de Vagabundo en un bosque a tu elección.
• Paso 3: Conseguir Misiones. Baraja tu mazo de misiones, roba 3 cartas de misión y colócalas bocarriba junto a ti.
• Paso 4: Llenar las Ruinas. Toma las 4 ruinas del mapa y coloca los objetos "R" bajo ellas aleatoriamente.
• Paso 5: Obtener los Objetos Iniciales. Toma los objetos marcados con "S" de tu carta de personaje y colócalos en tu tablero.
• Paso 6: Configurar Relaciones. Coloca los marcadores de relación de cada facción no Vagabundo en el espacio Indiferente.`,

    avanzada: `1º: Pon tu peón en cualquier bosque.
2º: Baraja el mazo de misiones. Roba 3 misiones y colócalas cerca.
3º: Pon 4 objetos "R" bajo las ruinas aleatoriamente, a menos que un no-Vagabundo ya lo haya hecho.
4º: Pon tu carta de personaje en tu espacio correspondiente y configura los objetos "S" iniciales.
5º: Pon los marcadores de relación para las facciones no-Vagabundo en el espacio Indiferente.`
  },

  "Compañía del Río": {
    normal: `• Paso 1: Juntar Guerreros. Forma la reserva de guerreros (15).
• Paso 2: Desembarcar. Coloca 4 guerreros en cualquier claro en contacto con el río.
• Paso 3: Rellenar Puestos Comerciales. Coloca 9 puestos comerciales en los espacios correspondientes.
• Paso 4: Obtener Fondos Iniciales. Coloca 3 guerreros en tu zona de Pagos.
• Paso 5: Precios Iniciales. Coloca 1 ficha de servicio en cualquier espacio de cada contador de Servicios.`,

    avanzada: `1º: Pon 4 guerreros entre cualquier claro a lo largo del río.
2º: Pon 3 guerreros en tu caja de Pagos.
3º: Llena tus registros de Puestos de Comercio con los puestos correspondientes.
4º: Pon tus 3 marcadores de servicio en tu registro de Servicios, estableciendo un precio para cada uno.`
  },

  "Culto Reptiliano": {
    normal: `• Paso 1: Juntar Guerreros. Forma la reserva de guerreros (25).
• Paso 2: Colocar Guerreros. En el claro de la esquina opuesta a la fortaleza o nido inicial, coloca 4 guerreros y 1 jardín. Luego coloca 1 guerrero en cada claro adyacente.
• Paso 3: Elegir al Paria. Coloca la ficha de paria sobre cualquier casilla de la zona paria.
• Paso 4: Rellenar los Contadores de Jardín. Coloca tus 14 jardines restantes en sus espacios correspondientes.`,

    avanzada: `1º: Elige un claro de hogar no adyacente a hogares enemigos.
2º: Pon 4 guerreros y 1 jardín correspondiente en tu hogar. Pon 2 guerreros en claros adyacentes tan equitativamente como sea posible.
3º: Pon 2 guerreros en tu caja de Acólitos.
4º: Llena tus registros de Jardines con jardines, excepto el espacio de más a la izquierda.
5º: Pon tu marcador de paria en su lado de Paria en cualquier espacio de la caja de Paria.`
  },

  "Ducado Subterráneo": {
    normal: `• Paso 1: Juntar Guerreros y Túneles. Forma las reservas de guerreros (20) y fichas de túneles (3).
• Paso 2: Preparar la Madriguera. Coloca la loseta de la madriguera cerca del mapa.
• Paso 3: Salir a la Superficie. Coloca 2 guerreros y 1 túnel en un claro de esquina libre, y 2 guerreros en cada claro adyacente.
• Paso 4: Rellenar los Marcadores de Edificios. Coloca 3 ciudadelas y 3 mercados en tus espacios de edificios.
• Paso 5: Recoger Ministros. Coloca las 9 cartas de ministro bocarriba en tu pila de ministros sin convencer.
• Paso 6: Rellenar los Espacios de Coronas. Coloca las 9 coronas en los espacios con puntos de victoria.`,

    avanzada: `1º: Elige un claro de hogar no adyacente a hogares enemigos.
2º: Pon 6 guerreros y 1 túnel en tu hogar. Pon 3 guerreros en claros adyacentes tan equitativamente como sea posible.
3º: Coloca tu tablero de Madriguera cerca del mapa.
4º: Llena tus registros de Edificios con mercados.
5º: Coloca tus cartas de ministros boca arriba en tu pila de Ministros No Influenciados.
6º: Pon tus 9 coronas en los espacios cuadrados con puntos de victoria.`
  },

  "Conspiración Córvida": {
    normal: `• Paso 1: Juntar Guerreros y conspiraciones. Forma las reservas de guerreros (15) y fichas de conspiracion (8).
• Paso 2: Dispersarse. Coloca 1 guerrero en un claro cualquiera de cada palo (3 en total).`,

    avanzada: `1º: Elige un claro de hogar y coloca 1 guerrero y 1 ficha de cnospiracion boca abajo allí.
2º: Pon 1 guerrero en un claro de cada palo (4 en total).`
  },

  "Señor de los Cientos": {
    avanzada: `1º: Elige un claro de hogar en el borde del mapa con 3+ claros entre él y los hogares enemigos.
2º: Pon tu Señor de la Guerra, 4 guerreros y 1 fortaleza en tu hogar.
3º: Pon tu carta de humor Obstinado en tu espacio de Carta de Humor.
4º: Pon los 4 objetos "R" bajo las ruinas aleatoriamente, a menos que esto ya se haya hecho.`
  },

  "Guardianes de Hierro": {
    avanzada: `1º: Baraja las 12 fichas de reliquia boca abajo. Pon una boca abajo aleatoriamente en cada bosque.
2º: Elige 2 claros de hogar adyacentes en el borde del mapa con 2 claros entre ellos y los hogares enemigos. Pon 4 guerreros en cada hogar.
3º: Pon las reliquias restantes tan equitativamente como sea posible entre las que no sean adyacentes a tus hogares.
4º: Mete una carta de Vasallo Fiel en cada uno de tus espacios de columna de Séquito.`
  }
};


// Elementos
const openBtn = document.getElementById("openPreparations");
const overlay = document.getElementById("prepOverlay");
const prepWindow = document.getElementById("prepWindow");
const prepList = document.getElementById("prepList");
const closePrep = document.getElementById("closePrep");
const details = document.getElementById("prepDetails");
const detailsTitle = document.getElementById("detailsTitle");
const detailsMode = document.getElementById("detailsMode");
const detailsText = document.getElementById("detailsText");
const closeDetails = document.getElementById("closeDetails");

openBtn.addEventListener("click", () => {
  overlay.classList.remove("hidden");
  prepWindow.classList.remove("hidden");
  document.body.classList.add("no-scroll");
});


// Mostrar lista
// Colores de facciones (exactos)
const factionColors = {
  "Marquesado": "#f7852a",
  "Nido de Águilas": "#325a9b",
  "Alianza del Bosque": "#6cc46d",
  "Vagabundo (B)": "#f7f7f7",
  "Vagabundo (N)": "#111111",
  "Compañía del Río": "#5fc9e3",
  "Culto Reptiliano": "#f0e300",
  "Ducado Subterráneo": "#e6cfa7",
  "Conspiración Córvida": "#5c3a91",
  "Señor de los Cientos": "#e04b3e",
  "Guardianes de Hierro": "#555555"
};


// REEMPLAZA CON ESTE BLOQUE (VERSIÓN 5 - SIN ESPACIOS)
Object.entries(prepData).forEach(([faction, data]) => {
  const div = document.createElement("div");
  const color = factionColors[faction] || "#444"; // color por defecto si falta alguno
  div.className = "p-3 rounded-xl text-white shadow-md text-center";
  div.style.backgroundColor = color;

  // Ajuste de color del texto si el fondo es muy claro
  if (["Marquesado", "Compañía del Río", "Culto Reptiliano", "Ducado Subterráneo", "Vagabundo (B)"].includes(faction)) {
    div.style.color = "#222"; // texto oscuro para fondos claros
  }

  // --- INICIO DEL CAMBIO ---
  // 1. Crear un array para los botones
  const buttons = [];
  
  if (data.normal) {
    // 2. Añadir el botón "Normal" si existe
    buttons.push(
      `<button class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-lg" data-faction="${faction}" data-mode="normal">Normal</button>`
    );
  }
  
  if (data.avanzada) {
    // 3. Añadir el botón "Avanzada" si existe
    buttons.push(
      `<button class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-lg" data-faction="${faction}" data-mode="avanzada">Avanzada</button>`
    );
  }
  
  // 4. Unir los botones con un solo espacio (la clase gap-2 se encarga del resto)
  const buttonsHtml = buttons.join(' ');
  // --- FIN DEL CAMBIO ---

  // 5. CONSTRUIR EL HTML FINAL SIN SALTOS DE LÍNEA
  // Usamos concatenación (+) en lugar de una plantilla (`) para
  // asegurar que no haya ningún espacio en blanco (newline) extra.
  div.innerHTML = 
    `<div class="text-lg font-semibold mb-2 text-center">${faction}</div>` +
    `<div class="flex justify-center gap-2">${buttonsHtml}</div>`;

  
  prepList.appendChild(div);

});
// FIN DEL BLOQUE DE REEMPLAZO

// Cerrar lista
closePrep.addEventListener("click", () => {
  overlay.classList.add("hidden");
  prepWindow.classList.add("hidden");
  document.body.classList.remove("no-scroll");
});

// Mostrar detalle
prepList.addEventListener("click", (e) => {
  const btn = e.target.closest("button[data-faction]");
  if (!btn) return;

  const faction = btn.dataset.faction;
  const mode = btn.dataset.mode;
  const text = prepData[faction][mode];

  detailsTitle.textContent = faction;
  detailsMode.textContent = mode === "normal" ? "Preparación Básica" : "Preparación Avanzada";
  detailsText.textContent = text;

  prepWindow.classList.add("hidden");
  details.classList.remove("hidden");
});

// Cerrar detalle
closeDetails.addEventListener("click", () => {
  details.classList.add("hidden");
  prepWindow.classList.remove("hidden");
});

// Cerrar todo con overlay
overlay.addEventListener("click", () => {
  overlay.classList.add("hidden");
  prepWindow.classList.add("hidden");
  details.classList.add("hidden");
  document.body.classList.remove("no-scroll");
});

</script>
<div id="qrModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="relative bg-white p-4 rounded-lg shadow-lg">
    <!-- Botón de cerrar -->
    <button id="closeQR" class="absolute -top-4 -right-4 w-10 h-10 rounded-full bg-blue-800 text-white flex items-center justify-center text-2xl font-bold hover:bg-blue-700 transform hover:scale-110 hover:rotate-12 transition duration-200">
      &times;
    </button>
    <div id="qr-placeholder" class="w-64 h-64 mx-auto flex justify-center items-center"></div>
  </div>
</div>


<script>
    // CAMBIO: Seleccionamos por clase, no por ID
  const qrTriggers = document.querySelectorAll('.showQR-trigger'); 
  const qrModal = document.getElementById('qrModal');
  const closeQR = document.getElementById('closeQR');
  const qrPlaceholder = document.getElementById('qr-placeholder'); // El div que creamos
  let qrCode = null; // Para no generarlo más de una vez

  const linkParaElQR = "https://root.seiyria.com/"; 

  // Función reutilizable para abrir el modal
  function openQRModal(e) {
    e.preventDefault();
    
    // Generar el QR solo la primera vez que se abre
    if (!qrCode) {
      qrPlaceholder.innerHTML = ''; // Limpiamos el div por si acaso
      qrCode = new QRCode(qrPlaceholder, {
        text: linkParaElQR,
        width: 256, // 256px (equivale a w-64 de Tailwind)
        height: 256, // 256px (equivale a h-64 de Tailwind)
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
      });
    }
    
    qrModal.classList.remove('hidden');
    qrModal.classList.add('flex');
    document.body.classList.add("no-scroll");
  }

  // CAMBIO: Aplicamos el evento a CADA botón encontrado
  qrTriggers.forEach(trigger => {
    trigger.addEventListener('click', openQRModal);
  });



  // Cerrar modal
  closeQR.addEventListener('click', function() {
    qrModal.classList.add('hidden');
    qrModal.classList.remove('flex');
    document.body.classList.remove("no-scroll");
  });

  // Opcional: cerrar si hace clic fuera del contenido
  qrModal.addEventListener('click', function(e) {
    if (e.target === qrModal) {
      qrModal.classList.add('hidden');
      qrModal.classList.remove('flex');
      document.body.classList.remove("no-scroll");
    }
  });
</script>

</body>
</html>



